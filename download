<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Downloads</title>
  <link rel="stylesheet" href="download.css">
  <script src="https://unpkg.com/sweetalert2@11"></script> <!-- For popup notifications -->
</head>
<body>
  <!-- Downloads Section -->
  <section class="downloads">
    <h2 class="gradient-text">Downloads</h2>
    <input type="text" id="codeInput" placeholder="Enter your download code here">
    <button id="downloadBtn">Download</button>
  </section>

  <!-- JavaScript Logic -->
  <script>
    document.getElementById("downloadBtn").addEventListener("click", function() {
      const code = document.getElementById("codeInput").value.trim();

      if (code) {
        // Send the code to the server to check for a file with this name
        fetch(`/download.php?code=${code}`)
          .then(response => response.json())
          .then(data => {
            if (data.success) {
              // If the file exists, trigger the download
              const link = document.createElement('a');
              link.href = data.fileUrl; // URL to the file
              link.download = code; // Download using the file name
              link.click();
            } else {
              // If file doesn't exist, show an error
              Swal.fire({
                icon: 'error',
                title: 'Authorization failed',
                text: 'Incorrect download code.',
              });
            }
          })
          .catch(error => {
            console.error('Error:', error);
            Swal.fire({
              icon: 'error',
              title: 'Authorization failed',
              text: 'An error occurred, please try again.',
            });
          });
      } else {
        Swal.fire({
          icon: 'warning',
          title: 'Input Required',
          text: 'Please enter a download code.',
        });
      }
    });
  </script>
</body>
</html>
